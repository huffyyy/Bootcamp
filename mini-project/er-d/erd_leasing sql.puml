@startuml erd-leasing

entity CUSTOMER {
    * customer_id int identity(1,1) <<pk>>
    --
    customer_name varchar(100) not null
    phone_number varchar(20)
    nik char(16) not null unique
    customer_email varchar(100) not null unique
    address varchar(150)
    created_at timestamp default current_timestamp
    updated_at timestamp
}

entity DEALER {
    * dealer_id int identity(1,1) <<pk>>
    --
    dealer_name varchar(50)
    address varchar(150)
    phone_number varchar(20)
}

entity MOTOR {
    * motor_id int identity(1,1) <<pk>>
    --
    motor_name varchar(25) not null
    brand varchar(25) not null
    category varchar(25)
    price numeric(15,2) not null
    description varchar(100)
    is_available boolean default true
    --
    dealer_id int <<fk>>
}

entity PROMO {
    * promo_id int identity(1,1) <<pk>>
    --
    promo_name varchar(50)
    discount_amount numeric(15,2) not null
    start_date date not null
    end_date date not null
    is_active boolean default true
}

entity LEASING_APPLICATION {
    * application_id int identity(1,1) <<pk>>
    --
    dp_amount numeric(15,2) not null
    tenor int not null
    monthly_installment numeric(15,2)
    admin_fee numeric(15,2)
    insurance_fee numeric(15,2)
    total_amount numeric(15,2) not null
    status statusFlow not null
    created_at timestamp default current_timestamp
    --
    customer_id int <<fk>>
    motor_id int <<fk>>
    promo_id int <<fk>>
    dealer_id int <<fk>>
}

entity APPLICATION_STATUS_HISTORY {
    * status_id int identity(1,1) <<pk>>
    --
    status_name statusFlow not null
    changed_at timestamp default current_timestamp
    changed_by int <<fk>>
    --
    application_id int <<fk>>
}

entity DELIVERY {
    * delivery_id int identity(1,1) <<pk>>
    --
    delivery_date date not null
    delivery_address varchar(150)
    status statusType
    created_at timestamp default current_timestamp
    completed_at timestamp
    --
    application_id int <<fk>>
    dealer_id int <<fk>>
}

entity DELIVERY_EVIDENCE {
    * evidence_id int identity(1,1) <<pk>>
    --
    file_url varchar(150)
    uploaded_at timestamp default current_timestamp
    --
    delivery_id int <<fk>>
    uploaded_by int <<fk>>
}

entity USER {
    * user_id int identity(1,1) <<pk>>
    --
    user_name varchar(50) not null
    user_email varchar(100) not null unique
    password varchar(255) not null
    role roleType not null
    dealer_id int <<fk>>
    created_at timestamp default current_timestamp
}

entity CREDIT_SCORING {
    * scoring_id int identity(1,1) <<pk>>
    --
    slik_checked boolean default false
    duplicate_checked boolean default false
    dsr_checked boolean default false
    dsr_value numeric(5,2)
    scoring_result varchar(30)
    scored_at timestamp
    --
    application_id int <<fk>>
    scored_by int <<fk>>
}

entity VERIFICATION {
    * verification_id int identity(1,1) <<pk>>
    --
    check_type varchar(50)
    is_passed boolean
    checked_at timestamp
    --
    application_id int <<fk>>
    checked_by int <<fk>>
}

entity APPROVAL {
    * approval_id int identity(1,1) <<pk>>
    --
    decision varchar(30)
    notes varchar(255)
    approved_at timestamp
    --
    application_id int <<fk>>
    approved_by int <<fk>>
}

enum statusType {
    REQUEST
    PROGRESS
    COMPLETED
}

enum roleType {
    CUSTOMER
    DEALER
    OFFICER
}

enum statusFlow {
    DRAFT
    SUBMITTED
    PRE_SCORING
    SURVEY
    APPROVED
    REJECTED
    CANCELLED
    DELIVERED
    COMPLETED
}

DEALER ||--o{ MOTOR
CUSTOMER ||--o{ LEASING_APPLICATION
MOTOR ||--o{ LEASING_APPLICATION
PROMO ||--o{ LEASING_APPLICATION
DEALER ||--o{ LEASING_APPLICATION
LEASING_APPLICATION ||--o{ APPLICATION_STATUS_HISTORY
USER ||--o{ APPLICATION_STATUS_HISTORY
LEASING_APPLICATION ||--|| DELIVERY
DEALER ||--o{ DELIVERY
DELIVERY ||--o{ DELIVERY_EVIDENCE
USER ||--o{ DELIVERY_EVIDENCE
LEASING_APPLICATION ||--|| CREDIT_SCORING
USER ||--o{ CREDIT_SCORING
LEASING_APPLICATION ||--|| APPROVAL
USER ||--o{ APPROVAL
LEASING_APPLICATION ||--o{ VERIFICATION
USER ||--o{ VERIFICATION

@enduml